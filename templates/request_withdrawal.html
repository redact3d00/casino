{% extends "base.html" %}
{% block title %}Вывод{% endblock %}
{% block content %}
<div class="card">
  <h2>Запрос на вывод</h2>
  <form id="withdrawal-form">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <div class="form-group">
      <label>Сумма</label>
      <input type="number" class="form-control" id="amount" min="20" max="{{ current_user.balance }}" required>
    </div>
    <button type="submit" class="btn btn-primary">Запросить</button>
  </form>
</div>
<script>
document.getElementById('withdrawal-form').onsubmit = async e => {
  e.preventDefault();
  const token = document.querySelector('input[name="csrf_token"]').value;
  const res = await fetch('/api/payments/withdraw', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json', 'X-CSRFToken': token },
    body: JSON.stringify({ amount: +document.getElementById('amount').value }),
    credentials: 'include'
  });
  if (res.ok) {
    alert('Заявка отправлена!');
    location.href = '/payments';
  }
};
</script>
{% endblock %}