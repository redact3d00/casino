{% extends "base.html" %}
{% block title %}Редактировать профиль{% endblock %}
{% block content %}
<div class="card">
  <h2>Редактировать профиль</h2>
  <form id="edit-profile-form">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <div class="form-group">
      <label>Имя</label>
      <input type="text" class="form-control" id="first_name" value="{{ current_user.first_name or '' }}">
    </div>
    <div class="form-group">
      <label>Фамилия</label>
      <input type="text" class="form-control" id="last_name" value="{{ current_user.last_name or '' }}">
    </div>
    <button type="submit" class="btn btn-primary">Сохранить</button>
  </form>
</div>
<script>
document.getElementById('edit-profile-form').onsubmit = async e => {
  e.preventDefault();
  const token = document.querySelector('input[name="csrf_token"]').value;
  await fetch('/api/user/profile', {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json', 'X-CSRFToken': token },
    body: JSON.stringify({
      first_name: document.getElementById('first_name').value,
      last_name: document.getElementById('last_name').value
    }),
    credentials: 'include'
  });
  alert('Профиль обновлён!');
  location.href = '/profile';
};
</script>
{% endblock %}