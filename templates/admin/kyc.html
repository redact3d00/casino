{% extends "admin/base.html" %}
{% block page_title %}KYC{% endblock %}

{% block content %}
<h2>Ожидают верификации</h2>
<div class="data-table">
  <table>
    <thead>
      <tr><th>ID</th><th>Пользователь</th><th>Тип</th><th>Дата</th><th>Документ</th><th>Действия</th></tr>
    </thead>
    <tbody id="kyc-body"></tbody>
  </table>
</div>

<script>
fetch('/api/admin/support/kyc/pending', { credentials: 'include' })
  .then(r => r.json())
  .then(d => {
    document.getElementById('kyc-body').innerHTML = d.documents.map(doc => `
      <tr>
        <td>${doc.id}</td>
        <td>${doc.username}</td>
        <td>${doc.document_type}</td>
        <td>${new Date(doc.submitted_at).toLocaleDateString()}</td>
        <td><a href="${doc.front_image}" target="_blank">Документ</a></td>
        <td>
          <button class="btn btn-sm btn-success" onclick="approveKYC(${doc.id})">Одобрить</button>
          <button class="btn btn-sm btn-danger" onclick="rejectKYC(${doc.id})">Отклонить</button>
        </td>
      </tr>
    `).join('');
  });

async function approveKYC(id) {
  await fetch(`/api/admin/kyc/${id}/approve`, { method: 'POST', credentials: 'include' });
  location.reload();
}

async function rejectKYC(id) {
  const reason = prompt('Причина отказа:');
  if (reason) {
    await fetch(`/api/admin/kyc/${id}/reject`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ reason }),
      credentials: 'include'
    });
    location.reload();
  }
}
</script>
{% endblock %}