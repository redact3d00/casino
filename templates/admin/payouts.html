{% extends "admin/base.html" %}
{% block page_title %}Выплаты{% endblock %}

{% block content %}
<h2>Запросы на вывод</h2>
<div class="data-table">
  <table>
    <thead>
      <tr><th>ID</th><th>Пользователь</th><th>Сумма</th><th>Метод</th><th>Статус</th><th>Действия</th></tr>
    </thead>
    <tbody id="payouts-body"></tbody>
  </table>
</div>

<script>
fetch('/api/admin/payouts', { credentials: 'include' })
  .then(r => r.json())
  .then(d => {
    document.getElementById('payouts-body').innerHTML = d.payouts.map(p => `
      <tr>
        <td>${p.id}</td>
        <td>${p.user.username}</td>
        <td>$${p.amount.toFixed(2)}</td>
        <td>${p.method}</td>
        <td>${p.status.value}</td>
        <td>
          ${p.status.value === 'pending' ? `
            <button class="btn btn-sm btn-success" onclick="approvePayout(${p.id})">Одобрить</button>
            <button class="btn btn-sm btn-danger" onclick="rejectPayout(${p.id})">Отклонить</button>
          ` : p.status.value}
        </td>
      </tr>
    `).join('');
  });

async function approvePayout(id) {
  if (!confirm('Одобрить выплату?')) return;
  await fetch(`/api/admin/payouts/${id}/approve`, { method: 'POST', credentials: 'include' });
  location.reload();
}

async function rejectPayout(id) {
  if (!confirm('Отклонить выплату?')) return;
  await fetch(`/api/admin/payouts/${id}/reject`, { method: 'POST', credentials: 'include' });
  location.reload();
}
</script>
{% endblock %}